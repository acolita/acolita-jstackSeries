@ECHO OFF

REM  ***            ATENCAO              ***
REM  *** CONFIGURE DE MANEIRA APROPRIADA ***

SET CAPTURE_PID=
SET CAPTURE_SIZE=300
SET CAPTURE_DELAY=1

SET APP_NAME=

REM ******************

ECHO CAPTURE STARTING

SET OUTPUTDIR=%COMPUTERNAME%_%APP_NAME%_%RANDOM%_%CAPTURE_PID%
MD %OUTPUTDIR%
ECHO CREATED %OUTPUTDIR% FOR OUTPUTING

REM FIND JSTACK PATH AND SETS TO JSTACKBIN VARIABLE

WHERE JAVA > %TEMP%\JAVAPATH.TXT

SET /P JAVAPATH=<%TEMP%\JAVAPATH.TXT

SET JAVAHOME=%JAVAPATH:~0,-8%

SET JSTACKBIN="%JAVAHOME%\JSTACK.EXE"

SET COUNTER=0

:WAITLOOP

	%JSTACKBIN% -l %CAPTURE_PID% > %OUTPUTDIR%\%COMPUTERNAME%-%APP_NAME%-%COUNTER%.TXT
	SET /A "COUNTER=COUNTER+1">NUL
	TIMEOUT /T %CAPTURE_DELAY% >NUL
	IF %COUNTER%==%CAPTURE_SIZE% GOTO NEXTSTEP
	GOTO WAITLOOP

:NEXTSTEP
ECHO DONE